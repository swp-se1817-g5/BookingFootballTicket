var cache={};function liveSearch(request,response){var term=request.term;if(term in cache){response(cache[term]);return;}
$.getJSON(auto_complete_source,request,function(data,status,xhr){cache[term]=data;response(data);});}
var searchSettings={minLength:1,source:liveSearch,focus:function(event,ui){$(this).val(ui.item.label);return false;},select:function(event,ui){window.location=ui.item.eventLink;return false;},};function _renderItem(ul,item){return $("<li>").append("<a>"+item.label+"<br><br>"+item.desc+"</a>").appendTo(ul);}
$(document).ready(function(){var isLoadingBank=false;$(".nav-image").click(function(){location.href=$(this).attr("action");});var loginStatus=$(".quick_list_window").attr("loginStatus");if(loginStatus==0){$(".quick_list_window .sell_2_btn").click(function(ev){var form=$(".quick_list_window .create-account-form");var requiredalert=form.find("input[name=sell_modal_account_fname]").attr("requiredalert");var minalert=form.find("input[name=sell_modal_account_fname]").attr("minalert");var emailmismatchalert=form.find("input[name=sell_modal_account_repeatemail]").attr("emailmismatchalert");var passminalert=form.find("input[name=sell_modal_account_password]").attr("passminalert");var passmaxalert=form.find("input[name=sell_modal_account_password]").attr("passmaxalert");var passMismatch=form.find("input[name=sell_modal_account_repeatpassword]").attr("passMismatch");var termsalert=form.find("input[name=sell_modal_account_terms]").attr("termsalert");var digitalert=form.find("input[name=sell_modal_account_tel]").attr("digitalert");var validator=form.validate({rules:{sell_modal_account_fname:{required:true,minlength:2,maxlength:60,},sell_modal_account_lname:{required:true,minlength:2,maxlength:60,},sell_modal_account_email:{required:true,email:true,},sell_modal_account_repeatemail:{equalTo:'[name="sell_modal_account_email"]',},sell_modal_account_password:{required:true,minlength:8,maxlength:16,},sell_modal_account_repeatpassword:{equalTo:'[name="sell_modal_account_password"]',},sell_modal_account_terms:{required:true,},sell_modal_account_tel:{digits:true,minlength:8,maxlength:20,},},messages:{sell_modal_account_fname:{required:requiredalert,minlength:minalert,},sell_modal_account_lname:{required:requiredalert,minlength:minalert,},sell_modal_account_email:{required:requiredalert,},sell_modal_account_repeatemail:{equalTo:emailmismatchalert,},sell_modal_account_password:{required:requiredalert,minlength:passminalert,maxlength:passmaxalert,},sell_modal_account_repeatpassword:{equalTo:passMismatch,},sell_modal_account_terms:{required:termsalert,},sell_modal_account_tel:{digits:digitalert,},},});if(validator.form()){var registerUrl=$(".sell_2_btn").attr("registerurl");var loginUrl=$(".sell_2_btn").attr("loginurl");$.ajax({url:registerUrl,data:{first_name:$("input[name=sell_modal_account_fname]").val(),last_name:$("input[name=sell_modal_account_lname]").val(),email:$("input[name=sell_modal_account_email]").val(),email_confirmation:$("input[name=sell_modal_account_repeatemail]",).val(),country_code:$("#tel_no_extenstion").val(),contact_no:$("input[name=sell_modal_account_tel]").val(),pwd:$("input[name=sell_modal_account_password]").val(),pwd_confirmation:$("input[name=sell_modal_account_repeatpassword]",).val(),terms_n_conditions:$("input[name=sell_modal_account_terms]").val(),favourite_team:"",},type:"POST",dataType:"json",success:function(response){$.ajax({url:loginUrl,data:{login:{username:$("input[name=sell_modal_account_email]").val(),password:$("input[name=sell_modal_account_password]").val(),},},type:"POST",dataType:"json",success:function(response){getAccount();$(".quick_list_window .create-account .next_btn").trigger("click",);},});},error:function($response){var message=jQuery.parseJSON($response.responseText);var output="";if(message.error){var output=message.error;}else{$.each(message,function(i,val){output+=val.join("<br />");});}
$(".quick_list_window .create-account-form .message").css("color","red").html(output);},});}});$(".dynamic-login").click(function(e){e.preventDefault();var loginUrl=$(".sell_2_btn").attr("loginurl");$.ajax({url:loginUrl,data:{login:{username:$(".quick_list_window #login-username").val(),password:$(".quick_list_window #login-password").val(),},},type:"POST",dataType:"json",beforeSend:function(){},success:function(response){if(response.error){$(".quick_list_window .login_form .message").html('<p class="error">'+response.error+"</p>",);}else{getAccount();$(".create-account .next_btn").trigger("click");}},});});}
$(".quick_list_window").on("getAccount",function(ev){if(loginStatus!=0&&!$(".quick_list_window").data("bankInfoLoaded")&&!isLoadingBank){getAccount();}});$(".quick_list_window .price_per_ticket").focusout(function(e){var decimalalert=$(this).attr("decimalalert");if(parseFloat($(this).val())<=0){alert(decimalalert);}});$(".quick_list_window .price_per_ticket").keyup(function(e){var currency=$(".quick_list_window .list-price").attr("currency");var conListingPrice=$("#conListingPrice").val();e.preventDefault();if(parseFloat($(this).val())>0){var price=parseFloat($(this).val());var bookingPerc=$(".quick_list_window .booking_fees_perc").val();price=(price/85)*100*(1+bookingPerc/100);$(".quick_list_window .list-price").html(conListingPrice+":  &nbsp; "+currency+" "+price.toFixed(2),);}});$(".quick_list_window .sell_1_btn").click(function(e){e.preventDefault();var ticket_id=$(".quick_list_window .ticket_id").val();var action=$(this).attr("action")+"/"+ticket_id;var validator=$(".quick-list-form").validate();if(validator.form()){var form=$("form.quick-list-form");var cur_loc=$(this);var listing=cur_loc.closest(".quick-list-form");var game_list_for=listing.find(".game_list_for").val();var ticket_type=listing.find("#ticket_type").val();var form_of_ticket=listing.find("#ticket_category").val();var loc_block=(listing.find(".loc_block").val()||[]).join(",");var loc_row=listing.find(".loc_row").val();var number_of_ticket=listing.find("#quantity").val();var list_competitively=listing.find(".list_competitively_check input[type='radio']:checked").val();var ready_to_ship=listing.find(".ready_ship_check input[type='radio']:checked").val();var hand_delivery=listing.find(".hand_delivery_check input[type='radio']:checked").val();var restriction_option=listing.find(".restriction_option_check input[type='radio']:checked").val();var ticket_notes=listing.find(".ticket_notes").val();var restrictions={[ticket_notes]:ticket_notes};var guest_stadium=listing.find("#guest_stadium").val();if(guest_stadium=="1"){var team_side=listing.find("#team_side").val();}else{var team_side=0;}
var price=listing.find(".price_per_ticket").val();var sell_preference=listing.find("#sell_preference").val();var item={event_id:ticket_id,ticket_type:ticket_type,form_of_ticket:form_of_ticket,loc_block:loc_block,loc_row:loc_row,number_of_ticket:number_of_ticket,list_competitively:list_competitively,ready_to_ship:ready_to_ship,hand_delivery:hand_delivery,restriction_option:restriction_option,restrictions:restrictions,price:price,team_side:team_side,sell_preference:sell_preference,};$.ajax({url:action,type:"post",dataType:"json",data:item,success:function(response){if(loginStatus==0){$(".quick-list-tickets .next_btn").trigger("click");}else{$(".quick-list-tickets").removeClass("active");$(".create-account .next_btn").trigger("click");}},error:function(response){console.log(response);},});}});var publishInProgress=false;$(".publish_ticket_btn").click(function(e){e.preventDefault();if(publishInProgress==true){return;}
publishInProgress=true;var bankAction=$(this).attr("bankaction");var validator=$(".payment-info-form").validate();if(validator.form()){$(".publish_ticket_btn").html("Processing......");var form=$(".payment-info-form");var serialiseData=form.serialize();var is_edited=false;if($("#account_holder").val()!==$("#account_holder").data("account-holder")||$("#iban").val()!==$("#iban").data("iban")||$("#bic-swift").val()!==$("#bic-swift").data("bic-swift")||$("#paypal_email").val()!==$("#paypal_email").data("paypal_email")){is_edited=true;}
if(is_edited){$.ajax({url:bankAction,data:{id:$(".bank-account").data("id"),account_holder:$("#account_holder").val(),iban:$("#iban").val(),bic_swift:$("#bic-swift").val(),paypal_email:$("#paypal_email").val(),},dataType:"json",type:"post",success:function(response){paymentTicket();},}).always(function(){publishInProgress=false;});}else{paymentTicket();}}else{publishInProgress=false;}});var progressXHR=null;function paymentTicket(){publishInProgress=true;var ticket_id=$(".quick_list_window .ticket_id").val();var form=$(".payment-info-form");var paymentAction=$(".publish_ticket_btn").attr("paymenturl")+"/"+ticket_id;var serialiseData=form.serialize();if(progressXHR){progressXHR.abort();}
progressXHR=$.ajax({url:paymentAction,type:"post",dataType:"json",data:serialiseData,success:function(response){if(response.status==true){publishTicket(ticket_id);}else{$(".publish_ticket_btn").html("Publish");if(response.message=="session is not set - ticket part 1"){$(".sell").trigger("click");}else{return false;}}},error:function(response){$(".publish_ticket_btn").html("Publish");},}).always(function(){publishInProgress=false;});}
var publishingXHR=null;function publishTicket(ticket_id){publishInProgress=true;var publishAction=$(".publish_ticket_btn").attr("publishurl")+"/"+ticket_id;var transConfirmBeforeSale=$("#transConfirmBeforeSale").val();if(publishingXHR){publishingXHR.abort();}
publishingXHR=$.ajax({url:publishAction,type:"post",dataType:"json",success:function(publishReponse){if(publishReponse.message=="held"){var holdTemplate='<div><h2>{{ticket_confirmation}}</h2><p style="line-height: 20px;">'+
transConfirmBeforeSale+
"</p></div>";$(".quick_list_window .payment-info").html(parseTemplate(holdTemplate)(publishReponse),);}else if(publishReponse.message){var successTemplate='<div><h2>{{ticket_confirmation}}</h2><p style="line-height: 20px;"> {{sell3long4}}<br><br> Please visit the <a href="{{listingUrl}}"  target="_blank"><b>{{sell3macc}}</b></a> area in order to view/modify listing <br></p></div>';$(".quick_list_window .payment-info").html(parseTemplate(successTemplate)(publishReponse),);}},error:function(publishReponse){$(".publish_ticket_btn").html("Publish");console.log(publishReponse);},}).always(function(){publishInProgress=false;});}
var blockTemplate="<select class='loc_block' name='loc_block' multiple>{{options}}</select>";var blockOptions="<option value='{{v}}'>{{c}}</option>";var blockMsg="<div class='removeLaters' style='background:#{{bg}}; padding:10px; color:white;'>{{msg}}</div>";$(".quick_list_window").on("change","select[name=ticket_type]",function(){var $this=$(this);var currentCat=$this.closest("form").find("[name=ticket_type] option:selected");var stadium_url=$(".quick_list_window .stadium_url").val();var ticket_id=$(".quick_list_window .ticket_id").val();var currentCat=currentCat.text().toLowerCase().trim().replace(/\//g,"%2F").replace(/\s+/g,"-");if(stadium_url.trim()==""){var options=parseTemplate(blockOptions)({v:"",c:"Block Unknown"});var objectlist=parseTemplate(blockTemplate)({options:options});$(".quick_list_window .loc_block").replaceWith(objectlist);$(".quick_list_window .removeLaters").remove();$(".quick_list_window .ticket_type_div").append('<div class="removeLaters" style="background:#7EC26D; padding:10px; color:white;">( Seat Blocks have loaded )</div>',);return;}
var data={eventId:ticket_id,};$.ajax({url:stadium_url+"/"+encodeURI(currentCat),context:document.body,type:"POST",data:data,beforeSend:function(xhr){$(".quick_list_window .removeLaters").remove();},}).done(function(data){var thisxx=data;var objectlist=parseTemplate(blockOptions)({v:"",c:"Block Unknown",});var arr=[];for(var x in thisxx){arr.push(thisxx[x]);}
arr.sort();$(arr).each(function(i,v){objectlist+=parseTemplate(blockOptions)({v:v,c:v});});$ql=$(".quick_list_window");if($ql.find(".loc_block").prop("type")=="text"){$ql.find(".loc_block").replaceWith(parseTemplate(blockTemplate)({options:objectlist}));}else{$ql.find(".loc_block").multiselect("destroy");$ql.find(".loc_block").parent().replaceWith(parseTemplate(blockTemplate)({options:objectlist}));}
$ql.find(".loc_block option:first-child").prop("selected",true);$ql.find(".loc_block").multiselect({maxHeight:200,onChange:function(ev){if(this.getSelected().length==0){this.select("");}else if(this.getSelected().length>1&&$(this.getSelected()[0]).val()==""){if(this.lastToggledInput.val()==""){this.deselectAll();this.select("");}else{this.deselect("");}}},});$ql.find(".removeLaters").remove();$ql.find(".ticket_type_div").append(parseTemplate(blockMsg)({bg:"3821fc",msg:"( Seat Blocks have loaded )",}),);}).fail(function(data){});});function getAccount(){var $pubBtn=$(".publish_ticket_btn");if(!$pubBtn.length){return;}
isLoadingBank=true;$.ajax({url:$pubBtn.attr("accounturl"),dataType:"json",type:"get",success:function(response){if(response.data){$(".quick_list_window").data("bankInfoLoaded",true);var bank=response.data;var $pinfo=$(".payment-info-form");if(bank.id){$pinfo.find(".bank-account").data("id",bank.id);$pinfo.find("#account_holder").val(bank.account_holder);$pinfo.find("#account_holder").data("account-holder",bank.account_holder);$pinfo.find("#iban").val(bank.iban);$pinfo.find("#iban").data("iban",bank.iban);$pinfo.find("#bic-swift").val(bank.bic_swift);$pinfo.find("#bic-swift").data("bic-swift",bank.bic_swift);$pinfo.find("#paypal_email").val(bank.paypal_email);$pinfo.find("#paypal_email").data("paypal_email",bank.paypal_email);$pinfo.find(".bank-option").prop("checked",true);}else{$pinfo.find(".bank-account").data("id","");$pinfo.find("#account_holder").data("account-holder","");$pinfo.find("#iban").data("iban","");$pinfo.find("#bic-swift").data("bic-swift","");$pinfo.find("#paypal_email").data("paypal_email","");}}},}).always(function(){isLoadingBank=false;});}});